<!doctype html>
<html class="no-js" lang="en">
<head>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-131686897-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-131686897-2');
</script>

<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<title>PHYSCI 70: Introduction to Digital Fabrication</title>
<meta name="description" content="Index Page">
<script src="../js/vendor/jquery.min.js"></script>
<script>
	$(function(){
	  $("#header").load("../header.html");
	  $("#footer").load("../footer.html");
	});
</script>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
<link href="../css/style.css" rel="stylesheet">
<script src="../js/vendor/modernizr.js"></script>

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/arduino-light.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/arduino.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

</head>
<body>

<div id="header"></div>

<!-- FIRST ROW -->
<div class="row">
	<div class="large-3  columns">
		<h3> Huzzah: HTTP Server </h3>
	</div >

	<div class="small-12 medium-12 large-9  columns">

		<h3> Huzzah: HTTP Server </h3>
		<p> For this workshop, please collect the following: 
			<ul> 
				<li><a href='https://www.adafruit.com/product/3405'>Huzzah board</a> </li>
				<li>Protoboard</li>
<!-- 				<li>Servo motor</li>
				<li>Potentiometer</li> -->
			</ul>
		</p> 

		<p> We previously looked at creating a web server on the Huzzah ESP32 board. However, you can also use the Huzzah as a web client, which can then access outside srvers. </p> 

		<p> SparkFun has a <a href='https://learn.sparkfun.com/tutorials/esp32-thing-plus-hookup-guide/'>tutorial for using an ESP32 to poll a remote domain</a> (http://example.com/) as a client. The following is a modification of that example to work the the National Weather Service's API. A <a href='https://techtutorialsx.com/2018/03/17/esp32-arduino-getting-weather-data-from-api/'>similar example</a> uses the OpenWeatherMap API, which requires you to register for an API key. </p>

<pre><code class="language-arduino">
#include &lt;WiFi.h&gt;
#include &lt;HTTPClient.h&gt;
 
const char* ssid = "YOUR_SSID";
const char* password =  "YOUR_PASSWORD";
 
const String endpoint = "https://api.weather.gov/gridpoints/TOP/31,80/forecast";
 
void setup() {
 
  Serial.begin(115200);
 
  WiFi.begin(ssid, password);
 
  while (WiFi.status() != WL_CONNECTED) {
    delay(1000);
    Serial.println("Connecting to WiFi..");
  }
 
  Serial.println("Connected to the WiFi network");
 
}

void loop() {
 
  if ((WiFi.status() == WL_CONNECTED)) { //Check the current connection status
 
    HTTPClient http;
 
    http.begin(endpoint); //Specify the URL
    int httpCode = http.GET();  //Make the request
 
    if (httpCode > 0) { //Check for the returning code
 
        String payload = http.getString();
        Serial.println(httpCode);
        Serial.println(payload);
      }
 
    else {
      Serial.println("Error on HTTP request");
    }
 
    http.end(); //Free the resources
  }
 
  delay(30000);
 
}
</code></pre>

		<p> But often, we'll want to process the data we get in the response, for example, to extract just the forecast high temperature for tomorrow. The response comes in the JSON format, andwe can use a library called ArduinoJson to make sense of it. </p> 


<pre><code class="language-arduino">
#include <WiFi.h>
#include <HTTPClient.h>
 
const char* ssid = "YOUR_SSID";
const char* password =  "YOUR_PASSWORD";
 
const String endpoint = "https://api.weather.gov/gridpoints/TOP/31,80/forecast";
 
void setup() {
 
  Serial.begin(115200);
 
  WiFi.begin(ssid, password);
 
  while (WiFi.status() != WL_CONNECTED) {
    delay(1000);
    Serial.println("Connecting to WiFi..");
  }
 
  Serial.println("Connected to the WiFi network");
 
}

void loop() {
 
  if ((WiFi.status() == WL_CONNECTED)) { //Check the current connection status
 
    HTTPClient http;
 
    http.begin(endpoint); //Specify the URL
    int httpCode = http.GET();  //Make the request
 
    if (httpCode > 0) { //Check for the returning code
 
        String payload = http.getString();
        Serial.println(httpCode);
        Serial.println(payload);

        const size_t capacity = JSON_OBJECT_SIZE(3) + JSON_ARRAY_SIZE(2) + 60;
          DynamicJsonBuffer jsonBuffer(capacity);
        Serial.println("JSON covert..");
     
        JsonObject& root = jsonBuffer.parseObject(payload);
                  if (!root.success()) {
                      Serial.println("parseObject() failed");
                     }
               
        Serial.println("JSON print..");
          int PAC = root["PAC"];
            Serial.println(PAC);

      }
 
    else {
      Serial.println("Error on HTTP request");
    }
 
    http.end(); //Free the resources
  }
 
  delay(30000);
 
}
</code></pre>


		<p> You can also use similar methods to get accurate date and time information from an internet source. Here's <a href='https://randomnerdtutorials.com/esp32-date-time-ntp-client-server-arduino/'>a tutorial</a> that demonstrates that. </p>

	</div >
</div>



<div id="footer"></div>

</body>
</html>
