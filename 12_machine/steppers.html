<!doctype html>
<html class="no-js" lang="en">
<head>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-131686897-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-131686897-2');
</script>

<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<title>PHYSCI 70: Introduction to Digital Fabrication</title>
<meta name="description" content="Index Page">
<script src="../js/vendor/jquery.min.js"></script>
<script>
	$(function(){
	  $("#header").load("../header.html");
	  $("#footer").load("../footer.html");
	});
</script>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
<link href="../css/style.css" rel="stylesheet">
<script src="../js/vendor/modernizr.js"></script>
</head>

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/arduino-light.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/arduino.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>


<body>

<div id="header"></div>


<!-- FIRST ROW -->
<div class="row">
	<div class="col-md-3">
		<h3> Stepper Motor Control</h3>
	</div >

	<div class="col-md-9">

		<h3> Stepper Motors </h3>
		<p> 	
			<a href='https://en.wikipedia.org/wiki/Stepper_motor'>Stepper motors</a> are great for position control. They can be found in desktop printers, plotters, 3d printers, CNC milling machines, and anything else requiring precise position control. 
		</p>

		<img src='./stepper-motor.gif' alt='stepper motor'>

		<h3> Pros </h3>
		<ul> <li> Excellent position accuracy</li>
   			<li> High holding torque </li>
		    <li> High reliability </li>
		    <li> Most steppers come in standard sizes </li>
		</ul>

		<h3> Cons </h3>
		<ul> <li> Small step distance limits top speed</li>
   			<li> It's possible to "skip" steps with high loads </li>
		    <li> Draws maximum current constantly </li>
		</ul>
		
		<p> We will be using bipolar stepper motors. Compared to unipolar stepper motors, bipolar steppers require more complicated circutry (in order to switch polarities) but are stronger by weight. </p>

		<iframe width="916" height="687" src="https://www.youtube.com/embed/u12dt1RqLW0" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

		<iframe width="916" height="550" src="https://www.youtube.com/embed/bkqoKWP4Oy4" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

		<h3> Driving Stepper Motors</h3>

		<p> There are a number of ways to drive stepper motors. We can send motor coils HIGH and LOW pulses directly from our microcontroller, but that won't give us much current.  </p>

		<p>A chopper drive addresses the problem of obtaining high torque at high speed from a stepper motor by turning the output voltage to the motor on and off rapidly (aka “chopping”) to control the motor current. At each step of the motor, a very high voltage (typically eight times higher than the motor’s nominal voltage) is applied to the motor windings. This causes the current to rise rapidly, according to the relationship between current rise and inductance. It also allows higher current to be produced, according to Ohm’s law. (From <a href='https://www.linearmotiontips.com/what-is-a-chopper-drive-for-a-stepper-motor/'> Linear Motion Tips</a>).</p>

		<p>Voltage = Current x Resistance, so stepper motors with higher coil resistance need less current to operate at the same voltage.  </p>

		<img src='./chopper.jpg' alt='stepper motor'>

		<h3> Microstepping</h3>

		<p> <a href='https://www.linearmotiontips.com/microstepping-basics/'>Microstepping</a> is a method of controlling stepper motors, typically used to achieve higher resolution or smoother motion at low speeds. 
		Microstepping control divides each full step into smaller steps to help smooth out the motor’s rotation, especially at slow speeds. For example, a 1.8 degree step can be divided up to 256 times, providing a step angle of 0.007 degrees (1.8 ÷ 256), or 51,200 microsteps per revolution. </p>

		<p>  Microstepping is achieved by using pulse-width modulated (PWM) voltage to control current to the motor windings. The driver sends two voltage sine waves, 90 degrees out of phase, to the motor windings. While current increases in one winding, it decreases in the other winding. This gradual transfer of current results in smoother motion and more consistent torque production than full- or half-step control.</p>

		<h3>Stepper Drivers </h3>

		<p> We will be using either the <a href='https://www.pololu.com/product/1182'>A4988 Driver</a> or the <a href='https://www.pololu.com/product/2134'>DRV8834 Low-Voltage Stepper Driver</a> (for 5V, portable projects). Make sure to review the product description and datasheet. 
		</p>

		<p> Note: These products can get hot enough to burn you long before the chip overheats. Take care when handling this product and other components connected to it. </p>

		<h3>Stepper Motor </h3>

		<p> We have a number of different bipolar stepper motors in the lab. (We also have <a href='https://create.arduino.cc/projecthub/debanshudas23/getting-started-with-stepper-motor-28byj-48-3de8c9'>28BYJ-48 unipolar steppers</a> and drivers, but that's a separate topic). 
		Find motors around the lab and look up their data sheets, especially rated current/phase, voltage, and phase resistance (e.g. US-17HS441, 17HS19-2004S1, etc.). Let's use the following motor for this example: 
		<a href='https://www.omc-stepperonline.com/nema-17-bipolar-1-8deg-26ncm-36-8oz-in-0-4a-12v-42x42x34mm-4-wires.html?search=Nema%2017%20Bipolar%201.8deg%2026Ncm%20%2836.8oz.in%29%200.4A%2012V%2042x42x34mm%204%20Wires'>Nema 17 Bipolar 1.8deg 26Ncm (36.8oz.in) 0.4A 12V 42x42x34mm 4 Wires</a>. </p>

		<p> Note some of the Electrical Specifications: 
			<ul> <li> Rated Current/phase: 0.4A </li>
    			<li> Voltage: 12V</li>
    			<li> Phase Resistance: 30ohms</li>
    		</ul>
    	</p>


    	<h3>Current Limiting </h3>
    	<p> Our motors have a maximum current rating of 0.4A with a 30Ω coil resistance, which would indicate a maximum motor supply of 12V. Using such a motor with a higher voltage would allow higher step rates, but the current must actively be limited to under 0.4A. (Anyway, we won't be using more than 9V). 
		 </p>

		<h3> Wiring</h3>
		<p> Wire the board as described on the product page. Include a 100uF capacitor between the VCC and GND in order to protect the driver from voltage spikes. In the photo, I've used a barrel jack connector to connect to a 9V wall outlet supply. Alternatively, you could run the motor at a lower voltage, like the 5V supply from the USB pin on the Huzzah. 

		</p>

		<img src='https://a.pololu-files.com/picture/0J4344.600.png?519b6c6d74c2f655dd6637eccd4590c0' alt='wiring diagram'>
		<br> <br>
		<img src='./step1.jpg' alt='wiring photo'>
		<br> <br>
		<img src='./step2.jpg' alt='wiring photo'>

		<h3> Programming </h3>
		<p> At the most basic level, we can control the chopper driver simply by sending pulses to the STEP pin of the driver. 
		</p>

<pre><code class="language-arduino">
const int stepPin = 13;
const int dirPin = 12;

void setup() {
  // put your setup code here, to run once:
  pinMode(stepPin, OUTPUT);
  pinMode(dirPin, OUTPUT);

  digitalWrite(dirPin, LOW);
}

void loop() {
  // put your main code here, to run repeatedly:
  digitalWrite(stepPin, LOW);
  delay(50);
  digitalWrite(stepPin, HIGH);
  delay(50);
}
</code></pre>

	<p> Switching the DIR pin from LOW to HIGH will reverse the direction of the motor. </p>

	<p> We can choose a library to help simplify control of stepper motors. The <a href='https://www.arduino.cc/en/reference/stepper'>Arduino Stepper Motor Library</a> supports differnt driver configurations. The <a href='https://www.airspayce.com/mikem/arduino/AccelStepper/index.html'>AccelStepper</a> library extends this functionality with acceleration/deceleration and non-blocking (no delay()) functions.   </p>


<pre><code class="language-arduino">
#include &lt;AccelStepper.h&gt;

const int stepPin = 13;  // blue
const int dirPin = 12;   // orange

// Define a stepper and the pins it will use
AccelStepper stepper(1, stepPin, dirPin); // initialise accelstepper for a two wire board

void setup()
{
}

void loop()
{
  if (stepper.distanceToGo() == 0)
  {
    // Random change to speed, position and acceleration
    // Make sure we dont get 0 speed or accelerations
    delay(1000);
    stepper.moveTo(rand() % 1000);
    stepper.setMaxSpeed((rand() % 1000) + 1);
    stepper.setAcceleration((rand() % 1000) + 1);
  }
  stepper.run();
}
</code></pre>


	</div>
</div>



<div id="footer"></div>

</body>
</html>
